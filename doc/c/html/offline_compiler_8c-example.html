<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EDI: offline_compiler.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EDI
   &#160;<span id="projectnumber">4.25A</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('offline_compiler_8c-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">offline_compiler.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * offline_compiler.c</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (c) 1997-2021 ETEL SA. All Rights Reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This software is the confidential and proprietary information of ETEL SA </span></div>
<div class="line"><span class="comment"> * (&quot;Confidential Information&quot;). You shall not disclose such Confidential </span></div>
<div class="line"><span class="comment"> * Information and shall use it only in accordance with the terms of the </span></div>
<div class="line"><span class="comment"> * license agreement you entered into with ETEL.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This software is provided &quot;AS IS&quot; without a warranty or representations of any kind. </span></div>
<div class="line"><span class="comment"> * ALL EXPRESS OR IMPLIED CONDITIONS, REPRESENTATIONS AND WARRANTIES, INCLUDING ANY IMPLIED WARRANTY </span></div>
<div class="line"><span class="comment"> * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NON-INFRINGEMENT ARE HEREBY EXCLUDED. ETEL AND ITS </span></div>
<div class="line"><span class="comment"> * LICENSORS SHALL NOT BE LIABLE FOR ANY DAMAGES SUFFERED BY LICENSEE AS A RESULT OF USING, MODIFYING OR DISTRIBUTING </span></div>
<div class="line"><span class="comment"> * THE SOFTWARE OR ITS DERIVATIVES. IN NO EVENT WILL ETEL OR ITS LICENSORS BE LIABLE FOR ANY LOST REVENUE, PROFIT OR </span></div>
<div class="line"><span class="comment"> * DATA, OR FOR DIRECT, INDIRECT, SPECIAL, CONSEQUENTIAL, INCIDENTAL OR PUNITIVE DAMAGES, HOWEVER CAUSED AND REGARDLESS </span></div>
<div class="line"><span class="comment"> * OF THE THEORY OF LIABILITY, ARISING OUT OF THE USE OF OR INABILITY TO USE SOFTWARE, EVEN IF ETEL HAS BEEN ADVISED OF </span></div>
<div class="line"><span class="comment"> * THE POSSIBILITY OF SUCH DAMAGES. THE ENTIRE RISK ARISING OUT OF USE, PERFORMANCE OR NON-PERFORMANCE OF THE SOFTWARE </span></div>
<div class="line"><span class="comment"> * REMAINS WITH THE LICENSEE. IF ETEL SHOULD NEVERTHELESS BE FOUND LIABLE, WHETER DIRECTLY OR INDRECTLY, FOR ANY LOSS, </span></div>
<div class="line"><span class="comment"> * DAMAGE OR INJURY ARISING UNDER THIS AGREEMENT OR OTHERWISE, REGARDLESS OF CAUSE OR ORIGIN, ON ANY BASIS WHATSOEVER, </span></div>
<div class="line"><span class="comment"> * ITS TOTAL MAXIMUM LIABILITY IS LIMITED TO CHF 100.000 WHICH WILL BE THE COMPLETE AND EXCLUSIVE REMEDY AGAINST ETEL.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> * This software is in particular not designed or intended .for use in on-line control of aircraft, air traffic, aircraft </span></div>
<div class="line"><span class="comment"> * navigation or aircraft communications; or in the design, construction, Operation or maintenance of any nuclear facility. </span></div>
<div class="line"><span class="comment"> * Licensee represents and warrants that it will not use or redistribute the Software for such purposes.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * This simple demo program shows how to :</span></div>
<div class="line"><span class="comment"> * - compile a sequence using an offline compiler.</span></div>
<div class="line"><span class="comment"> * - download the compiled sequence into a device</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * To run this demo without modification, you don&#39;t need to have a motor connected.</span></div>
<div class="line"><span class="comment"> * You must have one or many AccurET connected through USB or UltimET.</span></div>
<div class="line"><span class="comment"> * The example allows to choose between several configurations</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*** libraries ***/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Include the standard I/O library.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;conio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Include EDI high level library version 2.0x.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#include &lt;lib40.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="esc40_8h.html">esc40.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="etb40_8h.html">etb40.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dmd40_8h.html">dmd40.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dsa40_8h.html">dsa40.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> progress_fct(ESC *esc, <span class="keyword">const</span> <span class="keywordtype">char</span> *text, <span class="keywordtype">void</span> *user) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s&quot;</span>, text);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This function will ask the user to choose an url to open</span></div>
<div class="line"><span class="keywordtype">int</span> url_menu(<span class="keywordtype">char</span> *url) </div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> choice;</div>
<div class="line"> </div>
<div class="line">    fflush(stdin);</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n\n\nChoose Url\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;****************\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\tX: Exit\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\tA: ULTIMET\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\tB: USB\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;\n\t\tYour choice : &quot;</span>);</div>
<div class="line">        fflush(stdout);</div>
<div class="line">        scanf(<span class="stringliteral">&quot;%c&quot;</span>, &amp;choice);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">while</span> ((choice != <span class="charliteral">&#39;A&#39;</span>) &amp;&amp; (choice != <span class="charliteral">&#39;a&#39;</span>) &amp;&amp;</div>
<div class="line">           (choice != <span class="charliteral">&#39;B&#39;</span>) &amp;&amp; (choice != <span class="charliteral">&#39;b&#39;</span>) &amp;&amp;</div>
<div class="line">           (choice != <span class="charliteral">&#39;X&#39;</span>) &amp;&amp; (choice != <span class="charliteral">&#39;x&#39;</span>));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (choice) {</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div>
<div class="line">        strcpy(url, <span class="stringliteral">&quot;ULTIMET&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>:</div>
<div class="line">        strcpy(url, <span class="stringliteral">&quot;USB&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This function will ask the user to enter several axis number, their typs and their firmware version</span></div>
<div class="line"><span class="keywordtype">int</span> devs_menu(<span class="keywordtype">int</span> max_dev, ESC_OFFLINE_DEVICE devs[], ebool *master) </div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line">    <span class="keywordtype">char</span> m;</div>
<div class="line"> </div>
<div class="line">    fflush(stdin);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n\n\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; max_dev; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Enter %d%s axis to compile for (X for exit)\n&quot;</span>, i+1, (i == 0) ? <span class="stringliteral">&quot;st&quot;</span> : (i == 1) ? <span class="stringliteral">&quot;nd&quot;</span> : (i == 2) ? <span class="stringliteral">&quot;rd&quot;</span> : <span class="stringliteral">&quot;th&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (scanf(<span class="stringliteral">&quot;%d&quot;</span>, &amp;devs[i].axis) != 1) </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">if</span> ((devs[i].axis &lt; 0) || (devs[i].axis &gt; 64)) {</div>
<div class="line">            i--;</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span>(;;) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Enter typ of axis %d\n&quot;</span>, devs[i].axis);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tAccurET 400V: 32\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tAccurET 48V : 33\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tAccurET 300V: 34\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tAccurET DFC : 35\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tAccurET VHP:  36\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tUltimET PCI:  48\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tUltimET TCP/IP:  49\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">if</span> ((scanf(<span class="stringliteral">&quot;%d&quot;</span>, &amp;devs[i].prod) == 1) &amp;&amp;</div>
<div class="line">                (((devs[i].prod &gt;= 32) &amp;&amp; (devs[i].prod &lt;= 36)) ||</div>
<div class="line">                 ((devs[i].prod &gt;= 48) &amp;&amp; (devs[i].prod &lt;= 49))))</div>
<div class="line">                 <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span>(;;) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Enter firmware of axis %d\n&quot;</span>, devs[i].axis);</div>
<div class="line">            fflush(stdin);</div>
<div class="line">            <span class="keywordflow">if</span> ((scanf(<span class="stringliteral">&quot;%x&quot;</span>, &amp;devs[i].firmware) == 1) &amp;&amp;</div>
<div class="line">                <a name="a0"></a><a class="code" href="group__DMDAll.html#gab84fdc03ad54431f5ef8d749815a497c">dmd_is_drv_version_supported</a>(devs[i].prod, devs[i].firmware))</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                printf(<span class="stringliteral">&quot;Firmware version 0x%x not supported for drive type %s\n&quot;</span>, devs[i].firmware, <a name="a1"></a><a class="code" href="group__DMDAll.html#ga47905fd19ab7b16e6beab4313d910195">dmd_translate_drv_product</a>(devs[i].prod));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (i) {</div>
<div class="line">        <span class="keywordflow">for</span> (;;) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;\nCompile for master ? (Y/N)\n&quot;</span>);</div>
<div class="line">            fflush(stdin);</div>
<div class="line">            scanf(<span class="stringliteral">&quot;%c&quot;</span>, &amp;m);</div>
<div class="line">            <span class="keywordflow">if</span> ((m == <span class="charliteral">&#39;Y&#39;</span>) || (m == <span class="charliteral">&#39;y&#39;</span>)) {</div>
<div class="line">                *master = TRUE;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> ((m == <span class="charliteral">&#39;N&#39;</span>) || (m == <span class="charliteral">&#39;n&#39;</span>)) {</div>
<div class="line">                *master = FALSE;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> i;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This function will ask the user to enter several axis number</span></div>
<div class="line"><span class="keywordtype">int</span> axes_menu(<span class="keywordtype">int</span> max_axis, <span class="keywordtype">int</span> axis[]) </div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"> </div>
<div class="line">    fflush(stdin);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n\n\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; max_axis; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Enter %d st axis to download to (X for exit)\n&quot;</span>, i);</div>
<div class="line">        <span class="keywordflow">if</span> (scanf(<span class="stringliteral">&quot;%d&quot;</span>, &amp;axis[i]) != 1) </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">if</span> ((axis[i] &lt; 0) || (axis[i] &gt; 64)) </div>
<div class="line">            i--;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> i;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This function will ask the user to enter a filename</span></div>
<div class="line"><span class="comment">// depending on the flag must_exist, the file will be check if it exists or not</span></div>
<div class="line"><span class="keywordtype">int</span> file_menu(<span class="keywordtype">char</span> *file, <span class="keywordtype">char</span> *file_typ, <span class="keywordtype">boolean</span> must_exist) </div>
<div class="line">{</div>
<div class="line">    FILE *f;</div>
<div class="line"> </div>
<div class="line">    fflush(stdin);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n\n\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (;;) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Enter %s name (X for exit) : &quot;</span>, file_typ);</div>
<div class="line">        fflush(stdout);</div>
<div class="line">        scanf(<span class="stringliteral">&quot;%s&quot;</span>, file);</div>
<div class="line">        <span class="keywordflow">if</span> (!_stricmp(file, <span class="stringliteral">&quot;X&quot;</span>))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        <span class="keywordflow">if</span> (must_exist) {</div>
<div class="line">            <span class="keywordflow">if</span> (!(f = fopen(file, <span class="stringliteral">&quot;r&quot;</span>))) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;\n\nFile %s does not exist\n&quot;</span>, file);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (!(f = fopen(file, <span class="stringliteral">&quot;w&quot;</span>))) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;\n\nUnable to create File %s\n&quot;</span>, file);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * This function:</span></div>
<div class="line"><span class="comment"> * Ask the compiled filename to download</span></div>
<div class="line"><span class="comment"> * Ask the device into which the file must be downloaded</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> download_compiled_file()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> err;</div>
<div class="line">    <span class="keywordtype">int</span> axis[64];                               <span class="comment">// a table of all axis number</span></div>
<div class="line">    <span class="keywordtype">char</span> etb_url[32];                           <span class="comment">// url used by etb dll</span></div>
<div class="line">    <span class="keywordtype">char</span> dsa_url[64];                           <span class="comment">// url used by dsa dll</span></div>
<div class="line">    DSA_DEVICE *dwn_dev[64];                    <span class="comment">// A table of all downloaded devices</span></div>
<div class="line">    DSA_DEVICE_GROUP *dwn_grp = NULL;           <span class="comment">// A group of all devices into which the sequence will be downloaded</span></div>
<div class="line">    <span class="keywordtype">int</span> nb_dwn_drv;</div>
<div class="line">    <span class="keywordtype">char</span> filename[1024];</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Ask user about url to open</span></div>
<div class="line">    <span class="keywordflow">if</span> (url_menu(etb_url)) </div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Ask user about axes into which sequence must be downloaded</span></div>
<div class="line">    <span class="keywordflow">if</span> ((nb_dwn_drv = axes_menu(64, axis)) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Create group of all axes into which the sequence must be downloaded</span></div>
<div class="line">    <span class="keywordflow">if</span> (err = <a name="a2"></a><a class="code" href="group__DSAAll.html#ga2249758e1c8dc33416765e229dfc688f">dsa_create_device_group</a>(&amp;dwn_grp, nb_dwn_drv))</div>
<div class="line">        <span class="keywordflow">goto</span> _error;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0;i &lt; nb_dwn_drv; i++) {</div>
<div class="line">        dwn_dev[i] = NULL;</div>
<div class="line">        <span class="keywordflow">if</span> (axis[i] == 63) {</div>
<div class="line">            sprintf(dsa_url, <span class="stringliteral">&quot;etb:%s:*&quot;</span>, etb_url);</div>
<div class="line">            <span class="keywordflow">if</span> (err = <a name="a3"></a><a class="code" href="group__DSAAll.html#gad5ae47cdd1e4e82e9c33c778b597bcf6">dsa_create_master</a>(&amp;(dwn_dev[i])))</div>
<div class="line">                <span class="keywordflow">goto</span> _error;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            sprintf(dsa_url, <span class="stringliteral">&quot;etb:%s:%d&quot;</span>, etb_url, axis[i]);</div>
<div class="line">            <span class="keywordflow">if</span> (err = <a name="a4"></a><a class="code" href="group__DSAAll.html#gabb207b622ef11d41d9dfadf965e77200">dsa_create_drive</a>(&amp;(dwn_dev[i])))</div>
<div class="line">                <span class="keywordflow">goto</span> _error;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (err = <a name="a5"></a><a class="code" href="group__DSAAll.html#gac4f6cffd7dd579bcb9a7f60af5f6bb29">dsa_open_u</a>(dwn_dev[i], dsa_url))</div>
<div class="line">            <span class="keywordflow">goto</span> _error;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (err = <a name="a6"></a><a class="code" href="group__DSAAll.html#ga33ee7bc94a04ba24add4dc9d89146fb3">dsa_set_group_item</a>(dwn_grp, i, dwn_dev[i]))</div>
<div class="line">            <span class="keywordflow">goto</span> _error;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err = file_menu(filename, <span class="stringliteral">&quot;Compiled file&quot;</span>, TRUE))</div>
<div class="line">        <span class="keywordflow">goto</span> _error;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err = <a name="a7"></a><a class="code" href="group__DSAAll.html#ga53eb4d214739a08f5054b89ea4be629c">dsa_download_compiled_sequence_file_ex</a>(dwn_grp, filename, 0))</div>
<div class="line">        <span class="keywordflow">goto</span> _error;</div>
<div class="line"> </div>
<div class="line">_error:</div>
<div class="line">    <span class="keywordflow">if</span> (err) </div>
<div class="line">        ESC_DIAG(err, NULL);</div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * This function:</span></div>
<div class="line"><span class="comment"> * Ask devices configuration.</span></div>
<div class="line"><span class="comment"> * Ask sequence input filename</span></div>
<div class="line"><span class="comment"> * Ask compiled output filename</span></div>
<div class="line"><span class="comment"> * and call function which compile the sequence input file into a compiled output file</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> compile_sequence_file(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> err;</div>
<div class="line">    ESC *esc = NULL;                        </div>
<div class="line">    ESC_OFFLINE_DEVICE devs[64];</div>
<div class="line">    <span class="keywordtype">int</span> nb_dev;</div>
<div class="line">    <span class="keywordtype">char</span> ifilename[1024];</div>
<div class="line">    <span class="keywordtype">char</span> ofilename[1024];</div>
<div class="line">    ebool master;</div>
<div class="line"> </div>
<div class="line">    nb_dev = devs_menu(64, devs, &amp;master);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (err = <a name="a8"></a><a class="code" href="group__ESCCompilation.html#gae54b102f30abcdfd9c493c22e88058e8">esc_create_offline</a>(&amp;esc, nb_dev, devs))</div>
<div class="line">        <span class="keywordflow">goto</span> _error;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err = file_menu(ifilename, <span class="stringliteral">&quot;Sequence file&quot;</span>, TRUE))</div>
<div class="line">        <span class="keywordflow">goto</span> _error;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err = file_menu(ofilename, <span class="stringliteral">&quot;Compiled file&quot;</span>, FALSE))</div>
<div class="line">        <span class="keywordflow">goto</span> _error;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err = <a name="a9"></a><a class="code" href="group__ESCCompilation.html#ga342a41dcb6fe5d6c077571df7792186f">esc_compile_cseq_file</a>(esc, ifilename, ofilename, 0, master, progress_fct, NULL))</div>
<div class="line">        <span class="keywordflow">goto</span> _error;</div>
<div class="line"> </div>
<div class="line">_error:</div>
<div class="line">    <span class="keywordflow">if</span> (err) </div>
<div class="line">        ESC_DIAG(err, esc);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a10"></a><a class="code" href="group__ESCCompilation.html#ga03a1d2dc9e3dfdedca1950afa6a2f9c1">esc_is_valid</a>(esc))</div>
<div class="line">        <a name="a11"></a><a class="code" href="group__ESCCompilation.html#gadac208830416d77d1808ab9c146efc2b">esc_destroy</a>(&amp;esc);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *** Main entry point function.***</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> err;</div>
<div class="line">    <span class="keywordtype">char</span> choice;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Display menu */</span></div>
<div class="line">    <span class="keywordflow">for</span> (;;) {</div>
<div class="line">        <span class="keywordflow">do</span> {</div>
<div class="line">            fflush(stdin);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;--------------------------\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;C offline compiler example\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;--------------------------\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\n\n\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;Choose Action\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;*************\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tX: Exit\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tA: Compile sequence file offline\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\tB: Download compiled file into devices\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            printf(<span class="stringliteral">&quot;\n\t\tYour choice : &quot;</span>);</div>
<div class="line">            fflush(stdout);</div>
<div class="line">            scanf(<span class="stringliteral">&quot;%c&quot;</span>, &amp;choice);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">while</span> ((choice != <span class="charliteral">&#39;A&#39;</span>) &amp;&amp; (choice != <span class="charliteral">&#39;a&#39;</span>) &amp;&amp;</div>
<div class="line">               (choice != <span class="charliteral">&#39;B&#39;</span>) &amp;&amp; (choice != <span class="charliteral">&#39;b&#39;</span>) &amp;&amp;</div>
<div class="line">               (choice != <span class="charliteral">&#39;X&#39;</span>) &amp;&amp; (choice != <span class="charliteral">&#39;x&#39;</span>));</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span>(choice) {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>: </div>
<div class="line">                <span class="keywordflow">if</span> (err = compile_sequence_file()) {</div>
<div class="line">                    <span class="keywordflow">goto</span> _error;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>: </div>
<div class="line">                <span class="keywordflow">if</span> (err = download_compiled_file()) {</div>
<div class="line">                    <span class="keywordflow">goto</span> _error;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">_error:</div>
<div class="line">    <span class="keywordflow">if</span> (err) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Ended with error\n\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;Ended with success\n\n&quot;</span>);</div>
<div class="line">    _getch();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aetb40_8h_html"><div class="ttname"><a href="etb40_8h.html">etb40.h</a></div><div class="ttdoc">EDI-Version : 4.25A This header file contains public declaration for etel-bus library.</div></div>
<div class="ttc" id="agroup__DMDAll_html_ga47905fd19ab7b16e6beab4313d910195"><div class="ttname"><a href="group__DMDAll.html#ga47905fd19ab7b16e6beab4313d910195">dmd_translate_drv_product</a></div><div class="ttdeci">char_cp dmd_translate_drv_product(int d_prod)</div><div class="ttdoc">Translate the drive product number.</div><div class="ttdef"><b>Definition:</b> dmdprd.c:767</div></div>
<div class="ttc" id="agroup__DSAAll_html_ga53eb4d214739a08f5054b89ea4be629c"><div class="ttname"><a href="group__DSAAll.html#ga53eb4d214739a08f5054b89ea4be629c">dsa_download_compiled_sequence_file_ex</a></div><div class="ttdeci">int dsa_download_compiled_sequence_file_ex(DSA_DEVICE_BASE *dwn_grp, char *filename, dword flags)</div><div class="ttdoc">Download a pre-compiled sequence file.</div><div class="ttdef"><b>Definition:</b> dsagen.c:6998</div></div>
<div class="ttc" id="admd40_8h_html"><div class="ttname"><a href="dmd40_8h.html">dmd40.h</a></div><div class="ttdoc">EDI-Version : 4.25A This header file contains public declaration for drive meta-data library.</div></div>
<div class="ttc" id="agroup__ESCCompilation_html_ga03a1d2dc9e3dfdedca1950afa6a2f9c1"><div class="ttname"><a href="group__ESCCompilation.html#ga03a1d2dc9e3dfdedca1950afa6a2f9c1">esc_is_valid</a></div><div class="ttdeci">ebool esc_is_valid(ESC *esc)</div><div class="ttdoc">Check if the given pointer is a valid ESC pointer.</div><div class="ttdef"><b>Definition:</b> esc40.c:985</div></div>
<div class="ttc" id="aesc40_8h_html"><div class="ttname"><a href="esc40_8h.html">esc40.h</a></div><div class="ttdoc">EDI-Version : 4.25A This header file contains public declarations for the compiler interface library.</div></div>
<div class="ttc" id="agroup__ESCCompilation_html_gae54b102f30abcdfd9c493c22e88058e8"><div class="ttname"><a href="group__ESCCompilation.html#gae54b102f30abcdfd9c493c22e88058e8">esc_create_offline</a></div><div class="ttdeci">int esc_create_offline(ESC **esc, int nb_devices, ESC_OFFLINE_DEVICE present_devices[])</div><div class="ttdoc">Create a ESC object which will allow to compile a sequence file offline, without any connection to ha...</div><div class="ttdef"><b>Definition:</b> esc40.c:881</div></div>
<div class="ttc" id="agroup__DSAAll_html_gabb207b622ef11d41d9dfadf965e77200"><div class="ttname"><a href="group__DSAAll.html#gabb207b622ef11d41d9dfadf965e77200">dsa_create_drive</a></div><div class="ttdeci">int dsa_create_drive(DSA_DRIVE **rdrv)</div><div class="ttdoc">Create the dsa drive structure.</div><div class="ttdef"><b>Definition:</b> dsaopn.c:639</div></div>
<div class="ttc" id="agroup__DSAAll_html_gad5ae47cdd1e4e82e9c33c778b597bcf6"><div class="ttname"><a href="group__DSAAll.html#gad5ae47cdd1e4e82e9c33c778b597bcf6">dsa_create_master</a></div><div class="ttdeci">int dsa_create_master(DSA_MASTER **rmaster)</div><div class="ttdoc">Create the dsa master structure.</div><div class="ttdef"><b>Definition:</b> dsaopn.c:688</div></div>
<div class="ttc" id="agroup__ESCCompilation_html_gadac208830416d77d1808ab9c146efc2b"><div class="ttname"><a href="group__ESCCompilation.html#gadac208830416d77d1808ab9c146efc2b">esc_destroy</a></div><div class="ttdeci">int esc_destroy(ESC **esc)</div><div class="ttdoc">Destroy the ESC object.</div><div class="ttdef"><b>Definition:</b> esc40.c:957</div></div>
<div class="ttc" id="agroup__DMDAll_html_gab84fdc03ad54431f5ef8d749815a497c"><div class="ttname"><a href="group__DMDAll.html#gab84fdc03ad54431f5ef8d749815a497c">dmd_is_drv_version_supported</a></div><div class="ttdeci">ebool dmd_is_drv_version_supported(int prod, dword ver)</div><div class="ttdoc">Check if the specified drive product/version is supported.</div><div class="ttdef"><b>Definition:</b> dmdprd.c:969</div></div>
<div class="ttc" id="agroup__DSAAll_html_gac4f6cffd7dd579bcb9a7f60af5f6bb29"><div class="ttname"><a href="group__DSAAll.html#gac4f6cffd7dd579bcb9a7f60af5f6bb29">dsa_open_u</a></div><div class="ttdeci">int dsa_open_u(DSA_DEVICE *dev, char_cp url)</div><div class="ttdoc">Open a dsa device object.</div><div class="ttdef"><b>Definition:</b> dsaopn.c:1100</div></div>
<div class="ttc" id="agroup__DSAAll_html_ga33ee7bc94a04ba24add4dc9d89146fb3"><div class="ttname"><a href="group__DSAAll.html#ga33ee7bc94a04ba24add4dc9d89146fb3">dsa_set_group_item</a></div><div class="ttdeci">int dsa_set_group_item(DSA_DEVICE_GROUP *grp, int pos, DSA_DEVICE_BASE *dev)</div><div class="ttdoc">Define the specified element of the group structure.</div><div class="ttdef"><b>Definition:</b> dsagrp.c:392</div></div>
<div class="ttc" id="agroup__ESCCompilation_html_ga342a41dcb6fe5d6c077571df7792186f"><div class="ttname"><a href="group__ESCCompilation.html#ga342a41dcb6fe5d6c077571df7792186f">esc_compile_cseq_file</a></div><div class="ttdeci">int esc_compile_cseq_file(ESC *esc, char *seq_filename, char *eseq_filename, dword flags, ebool compile_for_master, ESC_PROGRESS *progress_fct, void *puser)</div><div class="ttdoc">Compile a sequence file and store output into a file which can be downloaded later.</div><div class="ttdef"><b>Definition:</b> esc40.c:1456</div></div>
<div class="ttc" id="agroup__DSAAll_html_ga2249758e1c8dc33416765e229dfc688f"><div class="ttname"><a href="group__DSAAll.html#ga2249758e1c8dc33416765e229dfc688f">dsa_create_device_group</a></div><div class="ttdeci">int dsa_create_device_group(DSA_DEVICE_GROUP **rgrp, int size)</div><div class="ttdoc">Create dsa device group structure.</div><div class="ttdef"><b>Definition:</b> dsagrp.c:137</div></div>
<div class="ttc" id="adsa40_8h_html"><div class="ttname"><a href="dsa40_8h.html">dsa40.h</a></div><div class="ttdoc">EDI-Version : 4.25A This header file contains public declarations for the high level library.</div></div>
<!-- HTML footer for doxygen 1.8.20-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright by <a href="http://www.etel.ch"><img class="footer" src="ETELLogo.gif" width="104" height="31" alt="ETEL"/></a> on Thu Aug 26 2021 </li>
  </ul>
</div>
</body>
</html>
